<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±åº¦åˆ†æAPIæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .success { border-color: #4caf50; background: #f1f8e9; }
        .error { border-color: #f44336; background: #ffebee; }
        .info { border-color: #2196f3; background: #e3f2fd; }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ·±åº¦åˆ†æAPIæµ‹è¯•</h1>
        
        <div class="test-section info">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æ·±åº¦åˆ†æçš„APIè°ƒç”¨åŠŸèƒ½ã€‚è¯·ç¡®ä¿ï¼š</p>
            <ul>
                <li>âœ… å·²é…ç½®æœ‰æ•ˆçš„APIå¯†é’¥</li>
                <li>âœ… å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ (http://localhost:5371)</li>
                <li>âœ… ç½‘ç»œè¿æ¥æ­£å¸¸</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ æµ‹è¯•æ­¥éª¤</h3>
            <button onclick="testAIConfig()">1. æ£€æŸ¥AIé…ç½®</button>
            <button onclick="testAPICall()">2. æµ‹è¯•APIè°ƒç”¨</button>
            <button onclick="testDeepAnalysis()">3. æµ‹è¯•æ·±åº¦åˆ†æ</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        function addResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const section = document.createElement('div');
            section.className = `test-section ${type}`;
            section.innerHTML = `
                <h3>${title}</h3>
                <div class="result">${content}</div>
            `;
            resultsDiv.appendChild(section);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testAIConfig() {
            addResult('ğŸ”‘ æ£€æŸ¥AIé…ç½®', 'æ­£åœ¨æ£€æŸ¥AIé…ç½®...', 'info');
            
            try {
                // æ£€æŸ¥localStorageä¸­çš„é…ç½®
                const basicConfig = localStorage.getItem('huitu-ai-config');
                const multiConfig = localStorage.getItem('huitu-multi-api-configs');
                
                let configInfo = '';
                
                if (basicConfig) {
                    const config = JSON.parse(basicConfig);
                    configInfo += `åŸºæœ¬é…ç½®:\n`;
                    configInfo += `- APIå¯†é’¥: ${config.apiKey ? 'å·²é…ç½®' : 'æœªé…ç½®'}\n`;
                    configInfo += `- å¯†é’¥é•¿åº¦: ${config.apiKey?.length || 0}\n`;
                    configInfo += `- æä¾›å•†: ${config.provider || 'unknown'}\n\n`;
                } else {
                    configInfo += 'åŸºæœ¬é…ç½®: æœªæ‰¾åˆ°\n\n';
                }
                
                if (multiConfig) {
                    const configs = JSON.parse(multiConfig);
                    configInfo += `å¤šAPIé…ç½®:\n`;
                    configInfo += `- é…ç½®æ•°é‡: ${Object.keys(configs).length}\n`;
                    configInfo += `- æ´»è·ƒé…ç½®: ${configs.active || 'none'}\n`;
                } else {
                    configInfo += 'å¤šAPIé…ç½®: æœªæ‰¾åˆ°\n';
                }
                
                addResult('âœ… AIé…ç½®æ£€æŸ¥å®Œæˆ', configInfo, 'success');
                
            } catch (error) {
                addResult('âŒ AIé…ç½®æ£€æŸ¥å¤±è´¥', error.message, 'error');
            }
        }

        async function testAPICall() {
            addResult('ğŸš€ æµ‹è¯•APIè°ƒç”¨', 'æ­£åœ¨æµ‹è¯•APIè°ƒç”¨...', 'info');
            
            try {
                // æµ‹è¯•åŸºæœ¬çš„fetchè°ƒç”¨
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-test' // è¿™é‡Œä¼šå¤±è´¥ï¼Œä½†å¯ä»¥æµ‹è¯•ç½‘ç»œè¿æ¥
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{ role: 'user', content: 'Hello' }],
                        max_tokens: 10
                    })
                });
                
                if (response.status === 401) {
                    addResult('âœ… APIè¿æ¥æ­£å¸¸', 'APIç«¯ç‚¹å¯è®¿é—®ï¼Œä½†éœ€è¦æœ‰æ•ˆçš„APIå¯†é’¥', 'success');
                } else {
                    addResult('âš ï¸ APIå“åº”å¼‚å¸¸', `çŠ¶æ€ç : ${response.status}`, 'error');
                }
                
            } catch (error) {
                if (error.message.includes('CORS')) {
                    addResult('âš ï¸ CORSé”™è¯¯', 'è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºæµè§ˆå™¨å®‰å…¨ç­–ç•¥', 'info');
                } else {
                    addResult('âŒ APIè°ƒç”¨å¤±è´¥', error.message, 'error');
                }
            }
        }

        async function testDeepAnalysis() {
            addResult('ğŸ” æµ‹è¯•æ·±åº¦åˆ†æ', 'æ­£åœ¨æµ‹è¯•æ·±åº¦åˆ†æåŠŸèƒ½...', 'info');
            
            try {
                // æµ‹è¯•æ·±åº¦åˆ†æé¡µé¢URL
                const testUrl = 'http://localhost:5371/deep-analysis?topic=æ™ºèƒ½å®¶å±…ç³»ç»Ÿ&type=api';
                
                addResult('âœ… æ·±åº¦åˆ†ææµ‹è¯•', `
æµ‹è¯•URL: ${testUrl}

è¦æµ‹è¯•æ·±åº¦åˆ†æAPIåŠŸèƒ½ï¼Œè¯·ï¼š
1. ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
2. é…ç½®æœ‰æ•ˆçš„APIå¯†é’¥
3. è®¿é—®ä¸Šè¿°URL
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„æ—¥å¿—è¾“å‡º

æ·±åº¦åˆ†ææ”¯æŒAPIè°ƒç”¨çš„æ¡ä»¶ï¼š
- URLå‚æ•° type=api
- AIæœåŠ¡å·²æ­£ç¡®é…ç½®
- ç½‘ç»œè¿æ¥æ­£å¸¸
                `, 'success');
                
            } catch (error) {
                addResult('âŒ æ·±åº¦åˆ†ææµ‹è¯•å¤±è´¥', error.message, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥é…ç½®
        window.onload = function() {
            testAIConfig();
        };
    </script>
</body>
</html>
