# HuiTu项目渐进式修改工作流程

**创建日期**: 2025-01-21  
**版本**: v1.0.0  
**适用范围**: 项目细节调整和功能优化

## 📋 工作流程概述

本工作流程确保每次修改都是渐进式的、可撤回的、可测试的，并保持完整的变更记录。

## 🔄 修改工作流程

### 阶段1: 修改准备 (Preparation)

#### 1.1 需求分析
- [ ] 明确修改目标和范围
- [ ] 分析现有代码结构
- [ ] 识别相关文件和组件
- [ ] 评估修改复杂度

#### 1.2 影响范围分析
- [ ] 分析代码依赖关系
- [ ] 识别可能受影响的组件
- [ ] 评估API接口影响
- [ ] 制定风险评估报告
- [ ] **平台分离策略分析** ⚠️
- [ ] **跨平台适配要求评估** ⚠️
- [ ] **移动端响应式设计考虑** ⚠️

#### 1.3 修改计划制定
- [ ] 制定详细的修改步骤
- [ ] 确定测试验证方案
- [ ] 准备回滚方案
- [ ] 设定修改完成标准

### 阶段2: 代码修改 (Implementation)

#### 2.1 创建修改分支
```bash
# 创建功能分支
git checkout -b feature/detail-adjustment-[功能名]

# 确保分支基于最新main
git rebase main
```

#### 2.2 渐进式代码修改
- [ ] 每次只修改一个小的功能点
- [ ] 保持代码的可读性和可维护性
- [ ] 遵循项目编码规范
- [ ] 添加必要的注释和文档
- [ ] **集成响应式设计hooks** ⚠️
- [ ] **考虑移动端触摸交互** ⚠️
- [ ] **适配不同屏幕尺寸** ⚠️
- [ ] **使用现有的移动端优化工具** ⚠️

#### 2.3 代码质量检查
- [ ] 运行TypeScript类型检查
- [ ] 执行ESLint代码检查
- [ ] 运行Prettier代码格式化
- [ ] 确保代码通过所有检查

### 阶段3: 测试验证 (Testing)

#### 3.1 单元测试
- [ ] 运行相关组件的单元测试
- [ ] 添加新的测试用例（如需要）
- [ ] 确保测试覆盖率达到要求
- [ ] 验证测试结果

#### 3.2 集成测试
- [ ] 测试修改与其他组件的集成
- [ ] 验证API接口的兼容性
- [ ] 检查数据流是否正常
- [ ] 确保没有破坏现有功能

#### 3.3 功能验证
- [ ] 手动测试修改后的功能
- [ ] 验证边界条件和异常情况
- [ ] 检查用户界面是否正常
- [ ] 确保性能没有明显下降
- [ ] **跨平台兼容性测试** ⚠️
- [ ] **移动端响应式测试** ⚠️
- [ ] **触摸交互测试** ⚠️
- [ ] **不同屏幕尺寸测试** ⚠️

### 阶段4: 文档更新 (Documentation)

#### 4.1 代码文档更新
- [ ] 更新相关代码注释
- [ ] 修改API文档（如需要）
- [ ] 更新类型定义文档
- [ ] 确保文档与代码一致

#### 4.2 用户文档更新
- [ ] 更新用户指南（如需要）
- [ ] 修改功能说明文档
- [ ] 更新操作步骤说明
- [ ] 确保用户文档准确

#### 4.3 变更记录更新
- [ ] 更新CHANGELOG.md
- [ ] 记录修改的详细信息
- [ ] 标记修改类型和影响范围
- [ ] 添加修改日期和版本信息

### 阶段5: 代码审查 (Review)

#### 5.1 自我审查
- [ ] 检查代码质量和规范
- [ ] 验证测试覆盖情况
- [ ] 确认文档更新完整
- [ ] 检查是否有遗漏

#### 5.2 同行审查
- [ ] 提交Pull Request
- [ ] 请求代码审查
- [ ] 根据反馈进行修改
- [ ] 确保审查通过

### 阶段6: 部署和监控 (Deployment)

#### 6.1 合并代码
```bash
# 合并到主分支
git checkout main
git merge feature/detail-adjustment-[功能名]

# 删除功能分支
git branch -d feature/detail-adjustment-[功能名]
```

#### 6.2 部署验证
- [ ] 在测试环境部署
- [ ] 进行完整的功能测试
- [ ] 验证性能指标
- [ ] 确保部署成功

#### 6.3 生产监控
- [ ] 监控生产环境运行状态
- [ ] 检查错误日志
- [ ] 验证用户反馈
- [ ] 确保系统稳定

## 🚨 回滚策略

### 快速回滚
```bash
# 回滚到上一个稳定版本
git revert [commit-hash]

# 或者回滚到特定标签
git checkout v2.0.0-stable
```

### 回滚检查清单
- [ ] 确认回滚原因和影响
- [ ] 备份当前状态
- [ ] 执行回滚操作
- [ ] 验证回滚后的功能
- [ ] 更新相关文档
- [ ] 通知相关人员

## 📊 质量保证检查清单

### 代码质量
- [ ] TypeScript类型检查通过
- [ ] ESLint检查无错误
- [ ] 代码格式化规范
- [ ] 测试覆盖率达标

### 功能质量
- [ ] 功能按预期工作
- [ ] 没有引入新的bug
- [ ] 性能没有明显下降
- [ ] 用户体验良好

### 文档质量
- [ ] 代码注释完整
- [ ] API文档准确
- [ ] 用户文档更新
- [ ] 变更记录详细

## 🔍 监控和反馈

### 修改后监控
- [ ] 监控系统运行状态
- [ ] 收集用户反馈
- [ ] 分析性能指标
- [ ] 检查错误日志

### 持续改进
- [ ] 分析修改效果
- [ ] 收集改进建议
- [ ] 优化工作流程
- [ ] 更新最佳实践

## 📝 工作流程记录模板

### 修改记录模板
```markdown
## 修改记录 - [日期]

### 修改信息
- **修改类型**: [新增/变更/修复/移除]
- **影响范围**: [具体描述]
- **修改文件**: [文件列表]
- **修改人员**: [姓名]

### 修改内容
- [详细描述修改内容]

### 测试结果
- [测试结果和验证情况]

### 影响分析
- [影响范围分析结果]

### 回滚方案
- [回滚步骤和注意事项]
```

## 🎯 最佳实践建议

### 修改原则
1. **渐进式**: 每次修改一个小的功能点
2. **可撤回**: 每次修改都可以独立回滚
3. **可测试**: 修改后可以立即验证
4. **文档同步**: 修改后更新相关文档
5. **平台兼容**: 考虑跨平台兼容性 ⚠️
6. **响应式设计**: 适配不同设备和屏幕尺寸 ⚠️

## 📱 平台分离策略和跨平台适配要求

### 平台分离架构
```
Web平台 (apps/web):
├── React: ^18.3.1 (稳定版本)
├── 目标: 浏览器环境
├── 响应式设计: 必需
└── 移动端适配: 必需

移动端平台 (apps/android):
├── React: 19.1.1 (最新版本)
├── 目标: React Native环境
├── 原生API: 相机、GPS、推送
└── 触摸交互: 必需

iOS平台 (apps/ios):
├── React Native
├── 目标: iOS原生环境
├── 原生API: iOS特定功能
└── 触摸交互: 必需
```

### 跨平台适配要求

#### 1. 响应式设计必须项
- [ ] 使用 `useResponsive` hook 检测设备类型
- [ ] 适配移动端、平板、桌面三种布局
- [ ] 考虑触摸交互和鼠标交互的差异
- [ ] 优化移动端的性能和加载速度

#### 2. 移动端优化必须项
- [ ] 使用 `useMobile` hook 获取移动端特性
- [ ] 集成 `mobileOptimization.ts` 工具函数
- [ ] 考虑网络状况和性能优化
- [ ] 适配不同屏幕尺寸和方向

#### 3. 平台特定功能
- [ ] Web端: 使用 localStorage、DOM API
- [ ] Android端: 使用 AsyncStorage、原生API
- [ ] iOS端: 使用 AsyncStorage、iOS特定API
- [ ] 共享逻辑: 使用 shared-utils 包

#### 4. 组件设计原则
- [ ] 组件必须支持响应式布局
- [ ] 按钮和交互元素适配触摸操作
- [ ] 文本和图标大小适配不同屏幕
- [ ] 考虑移动端的滚动和手势

### 常见问题和解决方案

#### 问题1: 忽略平台分离策略
**症状**: 新组件没有考虑移动端适配
**解决方案**: 
1. 立即集成 `useResponsive` hook
2. 添加移动端特定的样式和交互
3. 测试不同屏幕尺寸的显示效果

#### 问题2: 没有使用现有的移动端工具
**症状**: 重复造轮子，没有利用现有优化
**解决方案**:
1. 检查 `apps/web/src/hooks/useMobile.ts`
2. 使用 `apps/web/src/utils/mobileOptimization.ts`
3. 参考现有的移动端组件设计

#### 问题3: 跨平台兼容性问题
**症状**: 功能在某个平台上不工作
**解决方案**:
1. 使用平台检测条件渲染
2. 为不同平台提供不同的实现
3. 在 shared-utils 中提供统一的接口

### 质量保证
1. **自动化优先**: 使用自动化工具进行检查
2. **测试驱动**: 先写测试，再写代码
3. **文档先行**: 先更新文档，再修改代码
4. **持续监控**: 修改后持续监控系统状态

### 团队协作
1. **及时沟通**: 及时与团队成员沟通修改情况
2. **代码审查**: 所有修改都要经过代码审查
3. **知识分享**: 及时分享修改经验和最佳实践
4. **持续学习**: 从每次修改中学习和改进

---

**工作流程维护者**: HuiTu开发团队  
**最后更新**: 2025-01-21  
**下次审核**: 2025-02-21
