<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>奥斯本创新九问 · 智能分析工具</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      /* iOS WebView 特殊优化 */
      body {
        -webkit-touch-callout: none;
        -webkit-tap-highlight-color: transparent;
        overflow-x: hidden;
      }
      
      /* 只对非输入元素禁用文本选择 */
      body *:not(input):not(textarea) {
        -webkit-user-select: none;
        user-select: none;
      }
      
      /* 确保输入框可以正常选择文本 */
      input, textarea {
        -webkit-user-select: text;
        user-select: text;
      }
      
      /* 防止iOS缩放 */
      input, textarea {
        font-size: 16px !important;
      }
      
      /* 优化iOS滚动 */
      .main-page {
        -webkit-overflow-scrolling: touch;
      }
      
      /* 移动端适配 */
      @media (max-width: 768px) {
        .hero h1 {
          font-size: 24px;
        }
        
        .hero .sub {
          font-size: 16px;
        }
        
        .card {
          margin: 10px;
          padding: 16px;
        }
        
        .export-grid {
          grid-template-columns: 1fr;
          gap: 1px;
        }
        
        .cell {
          min-height: 150px;
          padding: 12px;
        }
        
        .cell textarea {
          min-height: 80px;
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <main class="main-page">
      <header class="hero">
        <h1>奥斯本创新九问 · 智能分析工具</h1>
        <p class="sub">基于AI深度分析，运用奥斯本检核表法进行创新思维拓展</p>
      </header>

      <section class="workspace">
        <div class="page-tabs">
          <div class="page-tab active" data-page="analysis">
            <span>主题分析</span>
          </div>
          <div class="page-tab" data-page="preview">
            <span>九宫格编辑</span>
          </div>
        </div>
        
        <!-- 分析页面 -->
        <div class="page active" id="analysis-page">
          <div class="analysis-container">
            <!-- 输入配置区 -->
            <div class="topic-section card">
              <div class="card-header">
                <h3>配置与输入</h3>
              </div>
              
              <div class="field">
                <label for="apiKeyInput">DeepSeek API密钥（可选）</label>
                <div class="input-group">
                  <input
                    id="apiKeyInput"
                    type="password"
                    placeholder="可选：输入API密钥获得AI深度分析..."
                    aria-label="DeepSeek API密钥输入框"
                  />
                  <button type="button" id="toggleApiKey" class="toggle-btn" aria-label="显示/隐藏密钥">
                    👁️
                  </button>
                </div>
                <small class="hint">不填写API密钥将使用本地案例数据库分析，填写后可获得AI深度分析，密钥将安全保存在浏览器本地</small>
              </div>

              <div class="field">
                <label for="topicInput">分析主题</label>
                <input
                  id="topicInput"
                  type="text"
                  placeholder="例如：智能咖啡机 / 在线教育平台 / 共享单车 / 社区团购..."
                />
                <small class="hint">输入您想要进行创新分析的主题，系统将进行深度解构和九维度创新分析</small>
              </div>

              <div class="actions">
                <button id="analyzeBtn" class="primary" aria-label="开始分析">
                  <span class="btn-text">开始分析</span>
                  <span class="loading-spinner" style="display: none;">分析中...</span>
                </button>
                <button id="clearBtn" class="ghost" aria-label="清空所有内容重新开始">
                  清空重来
                </button>
              </div>
            </div>

            <!-- 关键词分析结果区 -->
            <div id="keywordAnalysisCard" class="card">
              <div class="card-header">
                <h3>关键词深度分析</h3>
                <button id="downloadKeywordBtn" class="ghost small" style="display: none;">
                  下载分析图
                </button>
              </div>
              <div id="keywordAnalysisResult" class="analysis-content">
                <p class="placeholder">
                  点击"开始分析"进行主题分析<br>
                  <small>系统将基于案例数据库进行分析，填入API密钥可获得AI深度分析</small>
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- 九宫格编辑页面 -->
        <div class="page" id="preview-page">
          <div class="preview-container">
            <div class="preview-actions">
              <button id="downloadGridBtn" class="primary">
                下载九宫格分析图
              </button>
            </div>
            
            <!-- 统一的九宫格：可编辑且实时预览 -->
            <div id="exportArea" class="export-card">
              <div class="export-header">
                <div class="title">奥斯本创新九问分析</div>
                <div class="topic">分析主题：<span id="topicShow">（未填写）</span></div>
              </div>
              
              <div class="export-grid">
                <div class="cell">
                  <h3 class="cell-title">能否他用</h3>
                  <textarea id="t-he" data-key="he" placeholder="其他用途和应用场景..."></textarea>
                </div>
                <div class="cell">
                  <h3 class="cell-title">能否借用</h3>
                  <textarea id="t-jie" data-key="jie" placeholder="借鉴其他领域的做法..."></textarea>
                </div>
                <div class="cell">
                  <h3 class="cell-title">能否改变</h3>
                  <textarea id="t-gai" data-key="gai" placeholder="改变形态、流程、规则..."></textarea>
                </div>
                <div class="cell">
                  <h3 class="cell-title">能否扩大</h3>
                  <textarea id="t-da" data-key="da" placeholder="扩大规模、功能、影响..."></textarea>
                </div>
                <div class="cell">
                  <h3 class="cell-title">能否缩小</h3>
                  <textarea id="t-xiao" data-key="xiao" placeholder="简化、专注核心功能..."></textarea>
                </div>
                <div class="cell">
                  <h3 class="cell-title">能否替代</h3>
                  <textarea id="t-ti" data-key="ti" placeholder="替代材料、方法、技术..."></textarea>
                </div>
                <div class="cell">
                  <h3 class="cell-title">能否调整</h3>
                  <textarea id="t-tiao" data-key="tiao" placeholder="调整顺序、结构、流程..."></textarea>
                </div>
                <div class="cell">
                  <h3 class="cell-title">能否颠倒</h3>
                  <textarea id="t-dian" data-key="dian" placeholder="颠倒关系、反转思维..."></textarea>
                </div>
                <div class="cell">
                  <h3 class="cell-title">能否合并</h3>
                  <textarea id="t-hebing" data-key="hebing" placeholder="合并、组合、联动..."></textarea>
                </div>
              </div>
              
              <div class="export-footer">
                <span>基于奥斯本检核表法生成</span>
                <span id="dateShow"></span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <footer class="foot">
        <p>
          <strong>使用提示：</strong>
          每个文本框一行代表一个创新要点 · 支持实时编辑 · 可下载高清PNG图片
        </p>
      </footer>
    </main>

    <!-- 使用本地html2canvas库 -->
    <script>
      // 简化版html2canvas功能，用于iOS WebView
      window.html2canvas = function(element, options) {
        return new Promise((resolve, reject) => {
          // 在iOS WebView中，我们可以使用其他方式来实现截图功能
          // 这里提供一个基础的实现
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          
          // 设置canvas尺寸
          const rect = element.getBoundingClientRect();
          canvas.width = rect.width * 2; // 高分辨率
          canvas.height = rect.height * 2;
          ctx.scale(2, 2);
          
          // 简单的文本渲染（实际应用中需要更复杂的实现）
          ctx.fillStyle = 'white';
          ctx.fillRect(0, 0, rect.width, rect.height);
          
          ctx.fillStyle = 'black';
          ctx.font = '16px Arial';
          ctx.fillText('奥斯本创新九问分析', 20, 30);
          
          resolve(canvas);
        });
      };
    </script>
    <script src="app.js"></script>
  </body>
</html>